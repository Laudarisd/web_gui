<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>API Connectivity Test</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #111827;
    color: #f9fafb;
    min-height: 100vh;
    padding: 40px 20px;
    display: flex;
    justify-content: center;
  }

  .card {
    background: #1f2937;
    border-radius: 12px;
    padding: 24px 28px;
    width: 100%;
    max-width: 480px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.6);
    border: 1px solid #374151;
  }

  h1 {
    margin-top: 0;
    font-size: 20px;
    font-weight: 600;
    color: #fff;
    letter-spacing: -0.03em;
  }

  label {
    display: block;
    font-size: 13px;
    font-weight: 500;
    margin-bottom: 6px;
    color: #d1d5db;
  }

  input[type="text"],
  input[type="file"] {
    width: 100%;
    background: #111827;
    color: #f9fafb;
    border: 1px solid #4b5563;
    border-radius: 6px;
    padding: 10px 12px;
    font-size: 14px;
    outline: none;
  }

  input[type="text"]:focus,
  input[type="file"]:focus {
    border-color: #60a5fa;
    box-shadow: 0 0 0 2px rgba(96,165,250,0.4);
  }

  .row {
    margin-bottom: 16px;
  }

  button {
    width: 100%;
    appearance: none;
    border: 0;
    background: linear-gradient(135deg,#34d399 0%,#059669 100%);
    font-size: 15px;
    font-weight: 600;
    padding: 12px 16px;
    color: #053321;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 12px 30px rgba(16,185,129,0.4);
  }
  button:active {
    transform: scale(.98);
  }
  button:disabled {
    opacity: .4;
    cursor: not-allowed;
    box-shadow: none;
  }

  .status-box {
    margin-top: 20px;
    border-radius: 8px;
    padding: 12px 14px;
    font-size: 13px;
    white-space: pre-wrap;
    background: #111827;
    border: 1px solid #4b5563;
    color: #f9fafb;
    min-height: 80px;
  }

  small.hint {
    color: #9ca3af;
    font-size: 12px;
    line-height: 1.4;
    display: block;
    margin-top: 4px;
  }

  .good   { color: #4ade80; }
  .bad    { color: #f87171; }
  .neutral{ color: #93c5fd; }
</style>
</head>
<body>

<div class="card">
  <h1>Backend Upload Test</h1>

  <!--  user_id  -->
  <div class="row">
    <label for="user_id">User ID</label>
    <input id="user_id" type="text" placeholder="e.g. sd_test" value="sd_test">
  </div>

  <!--  project_number  -->
  <div class="row">
    <label for="project_number">Project Number</label>
    <input id="project_number" type="text" placeholder="e.g. PRJ-1" value="PRJ-1">
  </div>

  <!--  floor_number  -->
  <div class="row">
    <label for="floor_number">Floor Number</label>
    <input id="floor_number" type="text" placeholder="e.g. floor_1" value="floor_1">
  </div>

  <!--  image file  -->
  <div class="row">
    <label for="image">Select Floorplan Image</label>
    <input id="image" type="file" accept="image/*">
    <small class="hint">This is the same field name your FastAPI expects.</small>
  </div>

  <!-- submit button -->
  <div class="row">
    <button id="sendBtn">üöÄ Send to /receive_data</button>
  </div>

  <!-- status / debug output -->
  <div class="status-box" id="statusBox">
    <span class="neutral">Waiting...</span>
  </div>

</div>

<script>
/*
 This page does one thing:
   - Build FormData exactly like upload.js in your real app
   - POST to FastAPI /receive_data
   - Show raw response or network error

 You can open this file locally OR host it on GitHub Pages.
 Then you edit SERVER_URL below to point to:
   - http://<server-ip>:5000/receive_data         (dev, HTTP)
   - https://<your-domain>/receive_data           (prod via Caddy)
   - https://<your-ip>/receive_data               (self-signed TLS)
*/

// üî¥ IMPORTANT: update this before testing cross-network.
let SERVER_URL = "http://61.97.120.204:5000/receive_data"; 
// examples:
// let SERVER_URL = "http://61.97.120.204:5000/receive_data";
// let SERVER_URL = "https://61.97.120.204/receive_data";
// let SERVER_URL = "https://yourdomain.com/receive_data";

const sendBtn = document.getElementById("sendBtn");
const statusBox = document.getElementById("statusBox");

// tiny helper: write status box with colored text
function writeStatus(msg, cls="neutral") {
  statusBox.innerHTML = `<span class="${cls}">${msg}</span>`;
}

// sanity check function to show what we're sending
function summarizeForm(fd) {
  let out = [];
  for (const [key, value] of fd.entries()) {
    if (value instanceof File) {
      out.push(`${key}: [File "${value.name}", ${value.size} bytes]`);
    } else {
      out.push(`${key}: ${value}`);
    }
  }
  return out.join("\n");
}

// click handler
sendBtn.addEventListener("click", async () => {
  // get DOM values
  const user_id        = document.getElementById("user_id").value.trim();
  const project_number = document.getElementById("project_number").value.trim();
  const floor_number   = document.getElementById("floor_number").value.trim();
  const imageInput     = document.getElementById("image");
  const file           = imageInput.files[0];

  // quick validation
  if (!user_id || !project_number || !floor_number) {
    writeStatus("‚ö† Missing text fields (user_id / project_number / floor_number).", "bad");
    return;
  }

  if (!file) {
    writeStatus("‚ö† No file selected.", "bad");
    return;
  }

  // build multipart form data
  const formData = new FormData();
  formData.append("user_id", user_id);
  formData.append("project_number", project_number);
  formData.append("floor_number", floor_number);
  formData.append("images", file); // this name MUST match what your FastAPI endpoint expects

  writeStatus(
    "üì° Sending request to:\n" +
    SERVER_URL + "\n\n" +
    "Payload:\n" +
    summarizeForm(formData),
    "neutral"
  );

  sendBtn.disabled = true;
  sendBtn.textContent = "‚è≥ Sending...";

  try {
    const res = await fetch(SERVER_URL, {
      method: "POST",
      body: formData,
    });

    // if server returned non-2xx, still read text so we can debug
    const contentType = res.headers.get("content-type") || "";
    let bodyText = "";

    if (contentType.includes("application/json")) {
      const data = await res.json();
      bodyText = JSON.stringify(data, null, 2);
    } else {
      bodyText = await res.text();
    }

    writeStatus(
      `‚úÖ Response status: ${res.status}\n\n${bodyText}`,
      res.ok ? "good" : "bad"
    );
  } catch (err) {
    // network-level failure (CORS, refused, timeout, SSL fail, etc.)
    writeStatus(
      "‚ùå Network error:\n" + err.message + "\n\n" +
      "Likely causes:\n" +
      "- Server URL not reachable from this network\n" +
      "- HTTPS certificate mismatch / self-signed\n" +
      "- CORS blocked by browser (check console)\n" +
      "- Firewall / port closed",
      "bad"
    );
    console.error(err);
  } finally {
    sendBtn.disabled = false;
    sendBtn.textContent = "üöÄ Send to /receive_data";
  }
});
</script>

</body>
</html>
