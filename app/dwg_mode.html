<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI-CE Floorplan Visualizer – DWG Mode</title>

  <!-- Shared CSS (same as Image Mode) -->
  <link rel="stylesheet" href="./app/style/common.css">

  <!-- JSZip (same version as Image Mode) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>

<body>

<div class="menu-bar">
  <span class="menu-title">DWG MODE</span>
  <button id="settingsBtn" class="menu-btn">Settings</button>
</div>

<!-- === Settings Modal === -->
<div id="settingsModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" id="closeSettings">&times;</span>
    <h2>Server Settings</h2>

    <label for="appMode">Choose Mode:</label>
    <select id="appMode">
      <option value="image">Image Mode</option>
      <option value="dwg" selected>DWG Mode</option>
      <option value="twarch">TwARCH Mode</option>
    </select>

    <label for="serverIp">Server IP:</label>
    <input type="text" id="serverIp" value="127.0.0.1">

    <label for="serverPort">Port:</label>
    <input type="text" id="serverPort" value="5000">

    <button id="saveSettings" class="btn" type="button">Save</button>
  </div>
</div>

<div class="header-section">
  <h1>Floorplan Reconstruction</h1>
</div>

<div class="container">

  <!-- ✅ EXACT same grid wrapper as Image Mode -->
  <div class="three-columns">

    <!-- LEFT: Upload -->
    <div class="column">
      <h3>📤 Upload DWG ZIP</h3>

      <form id="uploadForm">

        <div class="form-group">
          <label>User ID:</label>
          <input type="text" id="user_id" value="web_user">
        </div>

        <div class="form-group">
          <label>Project Number:</label>
          <input type="text" id="project_number" value="PRJ-1">
        </div>

        <div class="form-group">
          <label>ZIP File (contains /original and /cropped):</label>
          <input type="file" id="zipInput" accept=".zip">
          <div id="zipPreview" class="image-preview"></div>
        </div>

        <button id="submitBtn" class="btn" type="submit">
          <span id="submitText">🚀 Send to Server</span>
        </button>

        <div class="progress-bar" id="progressBar" style="display:none;">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </form>

      <div id="uploadStatus"></div>
    </div>

    <!-- MIDDLE: ZIP Contents -->
    <div class="column">
      <h3>📦 ZIP Contents</h3>
      <button id="extractBtn" class="btn" type="button">📂 Extract ZIP</button>
      <div id="scaleInfo" class="scale-info" style="display:none;"></div>
      <div id="fileList" class="file-list" style="margin-top:15px;"></div>
    </div>

    <!-- RIGHT: Data Check -->
    <div class="column">
      <h3>🔍 Data Check</h3>
      <div id="dataCheckContent">
        <div class="data-placeholder">
          📄 Click on a file to view its contents
        </div>
      </div>
    </div>

  </div>

  <!-- Visualization Section (same as Image Mode) -->
  <div class="visualization-section" id="visualizationSection" style="display:none;">
    <h3>👁️ Visualization Check</h3>

    <div id="annotationControls"></div>

    <button id="toggleTextBtn" class="btn" type="button" style="margin-bottom:10px;">
      Hide Annotation
    </button>
    <button id="toggleKeyPointsBtn" class="btn" type="button" style="margin-bottom:10px;">
      Hide Key Points
    </button>

    <div class="viz-grid">

      <div class="viz-item main-viz">
        <div id="viewer" style="position:relative; overflow:hidden; width:100%; height:600px;">
          <div id="zoomContainer">
            <img id="mainImage">
            <canvas id="mainCanvas" style="position:absolute; left:0; top:0;"></canvas>
          </div>
        </div>
      </div>

      <div class="viz-item" id="viz1" style="display:none;">
        <img id="vizImg1">
        <div class="viz-label" id="vizLabel1"></div>
      </div>

      <div class="viz-item" id="viz2" style="display:none;">
        <img id="vizImg2">
        <div class="viz-label" id="vizLabel2"></div>
      </div>

      <div class="viz-item" id="viz3" style="display:none;">
        <img id="vizImg3">
        <div class="viz-label" id="vizLabel3"></div>
      </div>

      <div class="viz-item" id="viz4" style="display:none;">
        <img id="vizImg4">
        <div class="viz-label" id="vizLabel4"></div>
      </div>

      <div class="viz-item" id="viz5" style="display:none;">
        <img id="vizImg5">
        <div class="viz-label" id="vizLabel5"></div>
      </div>

    </div>
  </div>

</div>

<!-- DWG Mode Scripts -->
<script src="./app/src/dwg_mode/menu_dwg.js"></script>
<script src="./app/src/dwg_mode/upload_dwg.js"></script>
<script src="./app/src/dwg_mode/data.js"></script>

<!-- Shared Logic -->
<script src="./app/src/dwg_mode/zip.js"></script>
<script src="./app/src/dwg_mode/viz.js"></script>

<footer class="footer-bar">
  <div class="footer-content">
    <p class="footer-text">Personal Project</p>
    <p class="footer-text">Contact for Development: <a href="mailto:personal@INc.com" class="footer-link">personal@INc.</a></p>
  </div>
</footer>

</body>
</html>
