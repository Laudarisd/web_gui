<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI-CE Floorplan Visualizer - Image Mode</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<link rel="stylesheet" href="./app/style/common.css">
<link rel="stylesheet" href="./app/style/vector.css">
<link rel="stylesheet" href="./app/style/gif.css">
</head>
<body>

<div class="menu-bar">
  <span class="menu-title">IMAGE MODE</span>
  <button id="settingsBtn" class="menu-btn">Settings</button>
</div>

<div id="settingsModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" id="closeSettings">&times;</span>
    <h2>Server Settings</h2>
    <label for="appMode">Choose Mode:</label>
    <select id="appMode">
        <option value="image">Image Mode</option>
        <option value="dwg">DWG Mode</option>
        <option value="twarch">TwArch Mode</option>
    </select>
    <label for="serverIp">Server IP:</label>
    <input type="text" id="serverIp" value="127.0.0.1">
    <label for="serverPort">Port:</label>
    <input type="text" id="serverPort" value="5000">
    <button id="saveSettings" class="btn">Save</button>
  </div>
</div> 

<div class="header-section">
  <h1>Floorplan Reconstruction</h1>
</div>

<div class="container">
  
  <div class="three-columns">
    
    <div class="column">
      <h3>📤 Upload Floorplan</h3>
      <form id="uploadForm">
        <div class="form-group">
          <label>User ID:</label>
          <input type="text" id="user_id" required placeholder="e.g., sd_test">
        </div>
        
        <div class="form-group">
          <label>Project Number:</label>
          <input type="text" id="project_number" required placeholder="e.g., PRJ-1">
        </div>
        
        <div class="form-group">
          <label>Floor Number:</label>
          <input type="text" id="floor_number" required placeholder="e.g., floor_1">
        </div>
        
        <div class="form-group">
          <label>Select Image:</label>
          <input type="file" id="image" accept="image/*" required>
          <div id="imagePreview" class="image-preview"></div>
        </div>
        
        <button type="submit" class="btn" id="submitBtn">
          <span id="submitText">🚀 Send to Server</span>
        </button>
        <div class="progress-bar" id="progressBar" style="display:none;">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </form>
      
      <div id="uploadStatus"></div>
    </div>
    
    <div class="column">
      <h3>📦 ZIP Contents</h3>
      <!-- GIF PLACEHOLDER: Data Content -->
      <div id="dataContentGif" class="gif-placeholder">
        <div class="gif-wrapper">
          <img src="./app/assets/man%20and%20robot%20working.gif" alt="Man and robot working">
          <p class="gif-caption">Processing your floorplan data...</p>
        </div>
      </div>

      <div id="dataContentBody" class="gif-content is-hidden">
        <div id="zipInfo" class="info" style="display:none;"></div>
        <button id="extractBtn" class="btn" style="display:none;">📂 Extract ZIP</button>
        <div id="scaleInfo" class="scale-info" style="display:none;"></div>
        <div id="fileList" class="file-list" style="margin-top: 15px;"></div>
      </div>
    </div>
    
    <div class="column">
      <h3>🔍 Data Check</h3>
      <!-- GIF PLACEHOLDER: Data Check -->
      <div id="dataCheckGif" class="gif-placeholder">
        <div class="gif-wrapper">
          <img src="./app/assets/Live%20chatbot.gif" alt="Live chatbot">
          <p class="gif-caption">Analyzing data structure...</p>
        </div>
      </div>

      <div id="dataCheckBody" class="gif-content is-hidden">
        <div id="dataCheckContent" style="display:none;">
        </div>
      </div>
    </div>
    
  </div>
  
  <div class="visualization-section" id="visualizationSection" style="display:block;">
  <!-- ============================================================================
       VISUALIZATION MODE
       ============================================================================
       Shows image with annotation overlays. Default view on page load.
       ============================================================================ -->
  <!-- GIF PLACEHOLDER: Visualization Check -->
  <div id="vizGif" class="gif-placeholder">
    <div class="gif-wrapper">
      <img src="./app/assets/Loader%20cat.gif" alt="Loader cat">
      <p class="gif-caption">Preparing visualization...</p>
    </div>
  </div>

  <div id="vizContent" class="gif-content is-hidden">
    <div class="view-mode-toggle">
      <button data-view-mode="visualization" class="active">👁️ Visualization</button>
      <button data-view-mode="vectorization">📐 Vectorization</button>
    </div>

    <h3>👁️ Visualization Check</h3>
    <div id="annotationControls"></div>
    <button id="toggleTextBtn" class="btn" style="margin-bottom:10px;">Hide Annotation Text</button>
    <button id="toggleKeyPointsBtn" class="btn" style="margin-bottom:10px;">Hide Key Points</button>  
    <div class="viz-grid">
        <div class="viz-item main-viz" id="mainVizContainer">
          <!-- CRITICAL: Viewer MUST have fixed height (set in CSS: 600px) -->
          <div id="viewer" style="display:none;">
            <!-- Zoom container - size changes dynamically with zoom -->
            <div id="zoomContainer">
              <!-- Base image -->
              <img id="mainImage" src="" alt="Floorplan">
              <!-- Annotation canvas overlay -->
              <canvas id="mainCanvas"></canvas>
            </div>
          </div>
        </div>
        
        <div class="viz-item" id="viz1" style="display:none;">
          <img id="vizImg1">
          <div class="viz-label" id="vizLabel1">Content 1</div>
        </div>
        
        <div class="viz-item" id="viz2" style="display:none;">
          <img id="vizImg2">
          <div class="viz-label" id="vizLabel2">Content 2</div>
        </div>
        
        <div class="viz-item" id="viz3" style="display:none;">
          <img id="vizImg3">
          <div class="viz-label" id="vizLabel3">Content 3</div>
        </div>
        
        <div class="viz-item" id="viz4" style="display:none;">
          <img id="vizImg4">
          <div class="viz-label" id="vizLabel4">Content 4</div>
        </div>
        
        <div class="viz-item" id="viz5" style="display:none;">
          <img id="vizImg5">
          <div class="viz-label" id="vizLabel5">Content 5</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================================
       VECTORIZATION MODE
       ============================================================================
       Shows CAD-style vector representation without image background.
       Objects displayed as wireframes with precise coordinates.
       ============================================================================ -->
  <div id="vectorizationSection" style="display:none;">
    <div class="view-mode-toggle">
      <button data-view-mode="visualization">👁️ Visualization</button>
      <button data-view-mode="vectorization" class="active">📐 Vectorization</button>
    </div>

    <h3>📐 Vectorization (CAD Mode)</h3>
    
    <div class="vector-info">
      <div class="vector-info-item">
        <span class="vector-info-label">Scroll:</span> Zoom in/out
      </div>
      <div class="vector-info-item">
        <span class="vector-info-label">Drag:</span> Pan around
      </div>
      <div class="vector-info-item">
        <span class="vector-info-label">Double-click:</span> Reset view
      </div>
    </div>

    <!-- Fixed 1000×800px vector canvas container -->
    <div id="vectorContainer">
      <canvas id="vectorCanvas"></canvas>
    </div>

    <div class="vector-legend">
      <div class="vector-info-item">
        <span class="vector-info-label">Objects:</span> Wireframe outlines
      </div>
      <div class="vector-info-item">
        <span class="vector-info-label">Grid:</span> Reference spacing
      </div>
      <div class="vector-info-item">
        <span class="vector-info-label">Labels:</span> Annotation text
      </div>
      <div class="vector-info-item">
        <span class="vector-info-label">Vertices:</span> Polygon points
      </div>
    </div>
  </div>
  
</div>

<!-- GIF PLACEHOLDERS (loading states) -->
<script src="./app/src/image_mode/gif_animation/gif_animation.js"></script>

<script src="./app/src/image_mode/menu.js"></script>
<script src="./app/src/image_mode/upload.js"></script>
<script src="./app/src/image_mode/zip.js"></script>
<script src="./app/src/image_mode/json_file_viewer.js"></script>
<script src="./app/src/image_mode/viz_render.js"></script>
<script src="./app/src/image_mode/viewer_ui.js"></script>

<!-- Vectorization feature -->
<script src="./app/src/image_mode/vectorize/vectorize.js"></script>
<script src="./app/src/image_mode/vectorize/vector_view.js"></script>

<!-- ✅ Drag + arrow enhancement -->
<script>
(function () {
  const viewer = document.getElementById("viewer");
  if (!viewer) return;

  let isDragging = false;
  let startX = 0, startY = 0;
  let scrollLeft = 0, scrollTop = 0;

  viewer.addEventListener("mousedown", (e) => {
    if (e.button !== 0) return;
    e.preventDefault();
    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    scrollLeft = viewer.scrollLeft;
    scrollTop = viewer.scrollTop;
    viewer.style.cursor = "grabbing";
    viewer.style.userSelect = "none";
  });

  document.addEventListener("mousemove", (e) => {
    if (!isDragging) return;
    viewer.scrollLeft = scrollLeft - (e.clientX - startX);
    viewer.scrollTop  = scrollTop  - (e.clientY - startY);
  });

  document.addEventListener("mouseup", () => {
    isDragging = false;
    viewer.style.cursor = "grab";
    viewer.style.removeProperty("user-select");
  });

  document.addEventListener("keydown", (e) => {
    const step = 50;
    switch (e.key) {
      case "ArrowLeft":  viewer.scrollLeft -= step; break;
      case "ArrowRight": viewer.scrollLeft += step; break;
      case "ArrowUp":    viewer.scrollTop  -= step; break;
      case "ArrowDown":  viewer.scrollTop  += step; break;
    }
  });
})();
</script>

<footer class="footer-bar">
  <div class="footer-content">
    <p class="footer-text">Personal Project</p>
    <p class="footer-text">Contact for Development: <a href="mailto:personal@INc.com" class="footer-link">personal@INc.</a></p>
  </div>
</footer>

</body>
</html>
